<!doctype html>
<html lang=ru>
<head>
    <meta charset=utf-8>
    <meta content="width=device-width,initial-scale=1" name=viewport>
    <meta content="Подготовка рабочего места в Windows и Linux. Virtual Environment (venv). Ответы на вопросы"
          name=description>
    <meta content="#FFFFFF" name=theme-color>
    <meta content="Пишем ботов для Telegram на языке Python" property="og:title">
    <meta content="article" property="og:type">
    <meta content="Урок 0: Подготовка рабочего места в Windows и Linux. Virtual Environment (venv). Ответы на вопросы"
          property="og:description">
    <meta content="https://mastergroosha.github.io/telegram-tutorial/docs/pyTelegramBotAPI/lesson_00/"
          property="og:url">
    <meta content="Пишем ботов для Telegram на языке Python" property="og:site_name">
    <meta content="https://mastergroosha.github.io/telegram-tutorial/bot_logo.png" property="og:image">
    <title>Урок 0: Подготовка рабочего места в Windows и Linux. Virtual Environment (venv). Ответы на вопросы | Пишем
        ботов для Telegram на языке Python</title>
    <link href=/telegram-tutorial/manifest.json rel=manifest>
    <link href=/telegram-tutorial/favicon.png rel=icon type=image/x-icon>
    <link href=/telegram-tutorial/book.min.6df681b0bb21155cba49f6078e3559216772d8e03e780d240c73ea21817ed5e5.css
          integrity="sha256-bfaBsLshFVy6SfYHjjVZIWdy2OA+eA0kDHPqIYF+1eU="
          rel=stylesheet>
</head>
<body><input class=hidden id=menu-control type=checkbox>
<main class="container flex">
    <aside class=book-menu>
        <nav><h2 class=book-brand><a href=/telegram-tutorial><span>Пишем ботов для Telegram на языке Python</span></a>
        </h2>
            <ul>
                <li class=book-section-flat><span>pyTelegramBotAPI</span>
                    <ul>
                        <li><a href=/telegram-tutorial/docs/pyTelegramBotAPI/lesson_00/ class=active>Урок 0. Подготовка
                            рабочего места в Windows и Linux. Virtual Environment (venv). Ответы на вопросы</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_01/>Урок 1. Введение, простой echo-бот</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_02/>Урок 2. «Угадай мелодию». Подготовка</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_03/>Урок 3. «Угадай мелодию». Завершаем бота</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_04/>Урок 4. Вебхуки</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_05/>Урок 5. Автопостинг в каналы</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_06/>Урок 6. Собираем аналитику при помощи Botan
                            (неактуально)</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_07/>Урок 7. Встраиваемые боты (Inline)</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_08/>Урок 8. Bot API v2: Кнопки и редактирование
                            сообщений</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_09/>Урок 9. Bot API v2: Специальные кнопки, опять
                            редактирование сообщений, кэшированный инлайн</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_10/>Урок 10. Bot API v3. Автоматизируем работу в
                            группах</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_11/>Урок 11. Ведём (более-менее) осмысленные диалоги.
                            Конечные автоматы</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_12/>Урок 12. Запускаем несколько ботов на одном
                            сервере</a></li>
                    </ul>
                </li>
                <li class=book-section-flat><span>aiogram</span>
                    <ul>
                        <li><a href=/telegram-tutorial/docs/lesson_13/>Урок 13. Опросы v2.0</a></li>
                        <li><a href=/telegram-tutorial/docs/lesson_14/>Урок 14. Конечные автоматы в aiogram, разбиваем
                            логику по файлам</a></li>
                    </ul>
                </li>
            </ul>
            <ul>
                <li><a href=/telegram-tutorial/posts/></a></li>
            </ul>
        </nav>
        <script>(function () {
            var menu = document.querySelector("aside.book-menu nav");
            addEventListener("beforeunload", function (event) {
                localStorage.setItem("menu.scrollTop", menu.scrollTop);
            });
            menu.scrollTop = localStorage.getItem("menu.scrollTop");
        })();</script>
    </aside>
    <div class=book-page>
        <header class=book-header>
            <div class="flex align-center justify-between"><label for=menu-control><img
                    alt=Menu class=book-icon src=/telegram-tutorial/svg/menu.svg></label>
                <strong>Урок 0</strong>
                <label for=toc-control><img alt="Table of Contents" class=book-icon src=/telegram-tutorial/svg/toc.svg></label>
            </div>
            <input class=hidden id=toc-control type=checkbox>
            <aside class="hidden clearfix">
                <nav id=TableOfContents>
                    <ul>
                        <li>
                            <ul>
                                <li><a href=#предисловие>Предисловие</a></li>
                                <li><a href=#virtual-environment>Virtual environment</a></li>
                                <li><a href=#windows>Windows</a>
                                    <ul>
                                        <li><a href=#как-залить-файлы-на-сервер>Как залить файлы на сервер?</a></li>
                                    </ul>
                                </li>
                                <li><a href=#linux>Linux</a>
                                    <ul>
                                        <li><a href=#как-редактировать-файлы-на-сервере>Как редактировать файлы на
                                            сервере?</a></li>
                                    </ul>
                                </li>
                                <li><a href=#ответы-на-часто-задаваемые-вопросы-faq>Ответы на часто задаваемые вопросы
                                    (FAQ)</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>
            </aside>
        </header>
        <article class=markdown><h1>Подготовка рабочего места в Windows и Linux. Virtual Environment (venv). Ответы на
            вопросы</h1>
            <p>
            <h2 id=предисловие>Предисловие</h2>
            <p>Весь текст ниже появился как попытка дать универсальный ответ на те вопросы, которые дорогие читатели
                присылали и продолжают присылать раз за разом. Здесь не будет кода, связанного с ботами напрямую, а лишь
                советы по организации процесса написания. И, конечно же, не нужно воспринимать это как истину в
                последней инстанции, напротив, выбирайте те инструменты и подходы к разработке, которые лично вам
                кажутся удобными. Важная деталь: текст написан в конце 2019 года. Достаточно вступительных слов,
                поехали!</p>
            <p>Предположим, вы уже немного знаете язык Python 3 (забудьте про Python 2.7, он мёртв), умеете писать
                простенькие программы и хотите взяться за разработку ботов. Где это делать? В чём писать код? Как
                правило, у большинства начинающих программистов основной операционкой используется Microsoft Windows. С
                неё и начнём, но сперва…</p>
            <h2 id=virtual-environment>Virtual environment</h2>
            <p>Вы когда-нибудь пользовались VirtualBox? Например, чтобы «пощупать» другие операционные системы или
                просто установить какой-нибудь подозрительный софт. <a href=https://docs.python.org/3/library/venv.html>Python
                    Virtual environment</a> (далее — venv) чем-то напоминает «виртуалку». При его использовании
                создаётся копия выбранного интерпретатора Питон, а все устанавливаемые модули хранятся изолированно от
                общесистемных, тем самым, упрощается их обновление, удаление или изменение. Часто venv позволяет
                избежать ошибок, связанных с обратной совместимостью некоторых библиотек, а также обойтись без
                конфликтов с системными модулями.
                Работа с venv будет подробнее описана ниже в разделе Linux, но использовать его мы будем везде.</p>
            <h2 id=windows>Windows</h2>
            <p>Первым делом, разумеется, нужно скачать сам интерпретатор Python. На момент написания этого текста
                актуальной версией является <a href=https://www.python.org/downloads/release/python-381>Python 3.8.1</a>.
                В качестве каталога установки я рекомендую использовать что-то простое, вроде C:\Python38.
                Где писать код — личное дело каждого, конечно, но я всё же рекомендую использовать специальную среду
                разработки под названием PyCharm Community Edition. Бесплатной версии (та самая Community) более чем
                достаточно.
                После установки и первичной настройки выберите пункт File -> New Project. Укажите имя вашего первого
                проекта, а ниже укажите «New environment using virtualenv», ниже в качестве интерпретатора путь к
                python.exe каталога с Питоном (например, C:\Python38\python.exe).</p>
            <center><img src=https://mastergroosha.github.io/telegram-tutorial//images/l0_1.jpg></center>
            <center><i>Создание нового проекта в PyCharm</i></center>
            <p>После запуска откройте вкладку Terminal в левом нижнем углу и установите библиотеку pytelegrambotapi (не
                telebot!). Для любителей тыкать мышкой есть более запутанный вариант: File -> Settings -> Project {имя
                проекта} -> Project Interpreter -> кнопка «+» в правой части экрана.</p>
            <center><img src=https://mastergroosha.github.io/telegram-tutorial//images/l0_2.png></center>
            <center><i>Установка библиотеки через терминал в PyCharm</i></center>
            <p>Прекрасно, теперь начинайте творить! Создайте первый файл с исходником, нажав правой кнопкой мышки по
                имени проекта в списке файлов, затем New и Python File.</p>
            <center><img src=https://mastergroosha.github.io/telegram-tutorial//images/l0_3.png></center>
            <center><i>Создание нового файла кода в PyCharm</i></center>
            <p>Запустить код можно, выбрав сверху пункт Run, затем снова Run…, но с многоточием, и затем выбрав
                созданный ранее файл.</p>
            <h3 id=как-залить-файлы-на-сервер>Как залить файлы на сервер?</h3>
            <p>Для копирования файлов на удалённый сервер (обычно там стоит Linux), я использую замечательную бесплатную
                программу <a href=https://winscp.net/eng/download.php>WinSCP</a>, причём в ней присутствует режим
                автоматической синхронизации файлов, чтобы при любом изменении в локальном каталоге обновлялось
                содержимое на удалённой машине, избавляя вас от необходимости копировать всё вручную.</p>
            <center><img src=https://mastergroosha.github.io/telegram-tutorial//images/l0_4.png></center>
            <center><i>Скриншот программы WinSCP</i></center>
            <p>При помощи WinSCP можно даже просто подключиться к серверу и подправить файл «на лету», не забудьте
                только потом перезапустить бота!</p>
            <h2 id=linux>Linux</h2>
            <p>Если Linux у вас используется вместо Windows, то работа с PyCharm будет точно такой же, поэтому второй
                раз писать не имеет смысла. Далее рассмотрен процесс запуска в терминале на удалённом сервере.
                Прекрасно, вы написали бота и хотите где-то его запустить. Например, арендовали сервер у
                Scaleway/DigitalOcean/AWS/etc. Запустили сервер, подключились к нему по SSH, а там чёрный экран и
                терминальная Linux-сессия. Во-первых, давайте посмотрим, какой интерпретатор у нас выбран по умолчанию,
                введя команду <code>python3</code>.</p>
            <p>Хорошим правилом будет иметь на сервере ровно ту же версию Python, что и на своей локальной машине, во
                избежание различных неприятностей. Если версия на сервере ниже 3.7 и/или ниже той, что установлена
                локально, лучше всего будет установить её отдельно. Очень рекомендую <a
                        href=https://tecadmin.net/install-python-3-7-on-ubuntu-linuxmint/>вот эту статью</a>, по которой
                я для себя написал простой <a
                        href=https://gist.github.com/MasterGroosha/f46e24ec8dd5c0ce5cd872a479a19c96>скрипт</a> для
                автоматизации рутинных действий.
                Итак, интерпретатор установлен, теперь пора создать каталог, куда положим файлы бота. Выполните по
                очереди следующие команды:</p>
            <div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code
                    class=language-bash data-lang=bash>mkdir mybot
cd mybot
python3.7 -m venv venv
source venv/bin/activate
pip install pytelegrambotapi
deactivate
</code></pre>
            </div>
            <p>В результате должно получиться примерно то же самое, что на скриншоте ниже, с той лишь разницей, что я
                прервал процесс установки библиотеки для читабельности. Обратите внимание, что после подгрузки файла
                venv/bin/activate, перед названием пользователя и текущего каталога появится приписка (venv),
                означающая, что мы «вошли» в виртуальное окружение и устанавливаем библиотеки именно в него.</p>
            <center><img src=https://mastergroosha.github.io/telegram-tutorial//images/l0_5.jpg></center>
            <center><i>Создание venv в Linux-терминале</i></center>
            <p>Что произошло выше? Во-первых, мы создали каталог с названием mybot и перешли в него. Во-вторых, мы
                использовали Python версии 3.7 (в вашем случае это может быть не так), чтобы создать виртуальное
                окружение в подкаталоге venv. В-третьих, мы «активировали» venv и выполнили в нём нужную нам команду.
                Внутри venv команды pip и python точно знают, к какому именно интерпретатору они относятся, поэтому
                путаницы вроде «я установил библиотеку для Python 3.5, а запускаю из-под Python 3.7» попросту не будет.
                Наконец, в-четвёртых, мы деактивировали venv, поскольку он напрямую нам больше не нужен.
                Чтобы сделать жизнь ещё приятнее, давайте настроим автозагрузку бота, чтобы при возникновении ошибок или
                при перезапуске сервера он вновь запускался, избавляя нас от необходимости постоянно проверять всё
                вручную. Для этого мы воспользуемся подсистемой инициализации systemd, которая всё больше распространена
                в современных Linux-дистрибутивах. Прежде, чем описать службу systemd, откройте главный файл с ботом, в
                котором прописан его запуск и добавьте в качестве первой строки следующий код:
                <code>#!venv/bin/python</code></p>
            <p>Сохраните файл, закройте его и выполните команду <code>chmod +x имяфайласботом.py</code>, чтобы сделать
                его исполняемым.
                Теперь создайте файл mybot.service, и скопируйте туда следующий текст:</p>
            <div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code
                    class=language-systemd data-lang=systemd><span style=color:#00f>[Unit]</span>
Description=<span style=color:#a31515>MY BOT</span>
After=<span style=color:#a31515>network.target</span>

<span style=color:#00f>[Service]</span>
Type=<span style=color:#a31515>simple</span>
WorkingDirectory=<span style=color:#a31515>/home/user/mybot</span>
ExecStart=<span style=color:#a31515>/home/user/mybot/bot.py</span>
KillMode=<span style=color:#a31515>process</span>
Restart=<span style=color:#a31515>always</span>
RestartSec=<span style=color:#a31515>10</span>

<span style=color:#00f>[Install]</span>
WantedBy=<span style=color:#a31515>multi-user.target</span>
</code></pre>
            </div>
            <p>Отредактируйте поля <code>Description</code>, <code>WorkingDirectory</code> и <code>ExecStart</code>,
                сохраните и закройте файл. Далее скопируйте его в каталог <code>/etc/systemd/system</code>, введя свой
                пароль при необходимости (если сидите не из-под рута, что правильно, то ваш юзер должен иметь
                возможность выполнять команды от имени sudo). Затем выполните следующие команды для включения
                автозагрузки и запуска бота (опять-таки, требуются права суперпользователя):</p>
            <div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code
                    class=language-bash data-lang=bash>systemctl enable mybot.service
systemctl restart mybot
</code></pre>
            </div>
            <p>Наконец, проверьте состояние вашего бота командой <code>systemctl status mybot</code>. Его статус должен
                быть <code>Active (running)</code> зелёного цвета (если поддерживается разноцветный режим).</p>
            <center><img src=https://mastergroosha.github.io/telegram-tutorial//images/l0_6.png></center>
            <center><i>Проверка статуса бота через systemd</i></center>
            <h3 id=как-редактировать-файлы-на-сервере>Как редактировать файлы на сервере?</h3>
            <p>Если что-то нужно подправить небольшое, то неплохим вариантом остаётся старое доброе подключение по SSH и
                использование редакторов вроде micro, nano или даже vim с emacs. Но если вдруг у вас в качестве
                локальной машины применяется Linux, то крайне рекомендую редактор Visual Studio Code (<a
                        href=https://code.visualstudio.com>https://code.visualstudio.com</a>) с дополнением Remote-SSH.
                В этом случае, вы сможете прямо в VS Code открывать каталоги на сервере и редактировать файлы в удобном
                окружении и с подсветкой синтаксиса. К сожалению, насколько мне известно, расширение Remote-SSH не
                работает в Windows, но впоследствии этот недочёт будет устранён.</p>
            <h2 id=ответы-на-часто-задаваемые-вопросы-faq>Ответы на часто задаваемые вопросы (FAQ)</h2>
            <p><strong>Хочу научиться писать ботов. С чего мне начать?</strong><br>Прежде всего, пожалуйста, изучите
                хотя бы немного сам язык Python. Он довольно простой, но перед созданием ботов стоит понять азы.
                Конкретнее: переменные, циклы, функции, классы, обработка исключений, работа с файлами и файловой
                системой.</p>
            <p><strong>Можно ли писать ботов на телефоне?</strong><br>Да кто ж вам запретит-то? Но лучше от этого никому
                не будет, поверьте. Будет трудно, неудобно и контрпродуктивно. Используйте нормальный компьютер.</p>
            <p><strong>[pyTelegramBotAPI] Ошибка AttributeError: module &lsquo;telebot&rsquo; has no attribute &lsquo;TeleBot&rsquo;!</strong><br>На
                99% уверен, что вы установили библиотеку telebot вместо pytelegrambotapi. С учётом всего вышесказанного
                проще создать новое окружение venv, перенести туда нужные файлы и установить именно pytelegrambotapi,
                при этом в исходниках должно остаться import telebot.</p>
            <p><strong>Как мне держать бота запущеным в Windows?</strong><br>Запустите бота в PyCharm, не закрывайте
                приложение и не выключайте комп. Почти шутка. По-моему, Windows — не самая лучшая операционка для
                подобных вещей, проще арендовать сервер у европейских провайдеров, заодно не будет геморроя с варварами
                из Российского Консорциума Неадекватов.</p>
            <p><strong>Библиотека pyTelegramBotAPI не поддерживает новые фичи Bot API!</strong><br>К сожалению,
                упомянутая библиотека в 2019 году развивалась гораздо медленнее, чем хотелось. Если вы уже чувствуете
                себя уверенным ботописателем, подумайте о переходе на альтернативы вроде <a
                        href=https://github.com/aiogram/aiogram>aiogram</a>.</p>
            <p>В завершение хочется напомнить, что если у вас возникли замечания, предложения или вопросы, вы всегда
                можете <a href=https://github.com/MasterGroosha/telegram-tutorial/issues>открыть issue на Github</a> или
                прийти к нам в <a href=https://t.me/joinchat/ABtnIE7H7Q3TRRh8n8uNww>чатик</a>.</p><a
                    href=/telegram-tutorial/docs/lesson_01/ class=book-btn style=float:right>Урок №1 →</a></p></article>
        <footer class=book-footer>
            <div class="flex flex-wrap justify-between"></div>
        </footer>
        <label class="hidden book-menu-overlay" for=menu-control></label></div>
    <aside class=book-toc>
        <nav id=TableOfContents>
            <ul>
                <li>
                    <ul>
                        <li><a href=#предисловие>Предисловие</a></li>
                        <li><a href=#virtual-environment>Virtual environment</a></li>
                        <li><a href=#windows>Windows</a>
                            <ul>
                                <li><a href=#как-залить-файлы-на-сервер>Как залить файлы на сервер?</a></li>
                            </ul>
                        </li>
                        <li><a href=#linux>Linux</a>
                            <ul>
                                <li><a href=#как-редактировать-файлы-на-сервере>Как редактировать файлы на сервере?</a>
                                </li>
                            </ul>
                        </li>
                        <li><a href=#ответы-на-часто-задаваемые-вопросы-faq>Ответы на часто задаваемые вопросы (FAQ)</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </aside>
</main>
</body>
</html>